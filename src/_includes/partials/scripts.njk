{% if main %}
<script src="/js/main.js"></script>
<script src="/js/clipboard.js"></script>
<script>
  const clipboard = new ClipboardJS('.hex-color');

  clipboard.on('success', e => {
    e.trigger.classList.add("copied");
    setTimeout(() => e.trigger.blur(), 250);
    setTimeout(() => e.trigger.classList.remove("copied"), 1500);
    e.clearSelection();
  });
</script>
{% endif %}

{% if docs %}
<script src="/js/anchor.js"></script>
<script>anchors.add('h2');</script>
{% endif %}

<script>
  (function () {
    const storageKey = 'darken-mode';
    const root = document.documentElement;
    const toggle = document.getElementById('darkmode-toggle');
    const toggleText = document.getElementById('darkmode-text-toggle');
    const switches = document.querySelectorAll('.switch');

    const getStoredTheme = () => {
      try {
        return localStorage.getItem(storageKey);
      } catch (e) {
        return null;
      }
    };

    const setStoredTheme = (theme) => {
      try {
        localStorage.setItem(storageKey, theme);
      } catch (e) {
      }
    };

    const applyTheme = (theme, persist = false) => {
      const isDark = theme === 'dark';
      root.classList.toggle('darkmode-active', isDark);
      if (toggle) toggle.checked = isDark;
      if (toggleText) toggleText.innerText = isDark ? "Go bright" : "Go dark";
      if (persist) setStoredTheme(theme);
    };

    const preferred = getStoredTheme();
    const systemPrefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    const initialTheme = preferred || (systemPrefersDark ? 'dark' : 'light');
    applyTheme(initialTheme);

    if (toggle) {
      toggle.addEventListener('click', () => {
        const nextTheme = root.classList.contains('darkmode-active') ? 'light' : 'dark';
        applyTheme(nextTheme, true);
      });
    }

    window.requestAnimationFrame(() => {
      switches.forEach(s => s.classList.add('switch-ready'));
    });
  })();
</script>